# x86 实模式（Real Mode）内存结构

本文**单独、系统性**介绍 x86 **实模式（8086 / DOS / Bootloader）** 下的内存分配与布局结构，重点解释 **1MB 地址空间、固定区域用途、程序加载后的内存形态**，适合作为长期查阅文档。

---

## 一、实模式内存寻址基础

- CPU 地址总线：**20 位**
- 可寻址物理内存：**1MB（00000h ~ FFFFFh）**

### 地址计算公式

```text
物理地址 = 段寄存器 × 16 + 偏移地址
```

📌 这是一种**逻辑分段 + 物理线性内存**的模型。

---

## 二、1MB 实模式整体内存布局

```text
物理地址
FFFFFh ───────────────────────────
       系统 BIOS ROM
F0000h ───────────────────────────
       扩展 BIOS / 硬件 ROM
E0000h ───────────────────────────
       显存 / 内存映射 I/O
A0000h ───────────────────────────
       常规内存（Conventional Memory）
00000h ───────────────────────────
```

> 此布局并非 CPU 强制，而是 IBM PC 体系结构约定形成的事实标准。

---

## 三、常规内存（0 ~ 640KB）

### 1️⃣ 中断向量表（IVT）

| 项目 | 说明            |
| ---- | --------------- |
| 地址 | 00000h ~ 003FFh |
| 大小 | 1 KB            |
| 数量 | 256 个中断向量  |

- 每个中断向量占 **4 字节**
- 结构：`IP (2B) + CS (2B)`

```text
中断 n 的入口地址 = n × 4
```

---

### 2️⃣ BIOS 数据区（BDA）

| 项目 | 说明            |
| ---- | --------------- |
| 地址 | 00400h ~ 004FFh |
| 大小 | 256 字节        |

保存内容包括：

- 串口 / 并口数量
- 键盘状态
- 当前显示模式
- 定时器计数

---

### 3️⃣ DOS / 用户程序可用内存

| 地址范围        | 说明           |
| --------------- | -------------- |
| 00500h ~ 09FFFh | 程序、数据、栈 |

这是 DOS 程序最主要的活动区域。

---

## 四、显存区域（Video Memory）

| 地址范围        | 用途     | 说明         |
| --------------- | -------- | ------------ |
| A0000h ~ AFFFFh | 图形模式 | VGA 图形显存 |
| B8000h ~ BFFFFh | 文本模式 | 彩色文本     |
| B0000h ~ B7FFFh | 文本模式 | 单色显示     |

### 文本模式示例

```asm
mov ax, 0B800h
mov es, ax
mov byte [es:0], 'A'
```

---

## 五、BIOS ROM 区域

| 地址范围        | 用途                    |
| --------------- | ----------------------- |
| C0000h ~ DFFFFh | 扩展 BIOS（显卡、网卡） |
| F0000h ~ FFFFFh | 系统 BIOS               |

- ROM 只读
- 上电后 CPU 从 **F000:FFF0** 开始执行

---

## 六、程序加载后的内存结构

### 1️⃣ COM 程序内存结构

```text
段基址
+------------------+ 0000h
| PSP (256B)       |
+------------------+ 0100h
| 程序代码         |
+------------------+
| 数据区           |
+------------------+
| 栈（向下增长）   | FFFFh
+------------------+
```

特点：

- CS = DS = ES = SS
- 程序入口：`CS:0100h`

---

### 2️⃣ EXE 程序内存结构（简述）

- 代码段、数据段、栈段通常不同
- 加载器负责重定位段地址

---

## 七、Bootloader 内存位置（重要）

| 项目     | 说明      |
| -------- | --------- |
| 加载地址 | 0000:7C00 |
| 大小     | 512 字节  |
| 结束标志 | 55 AA     |

- BIOS 使用 INT 13h 加载
- 执行入口：`CS:IP = 0000:7C00`

---

## 八、段重叠与内存别名（实模式特性）

由于：

```text
段 × 16 + 偏移
```

以下地址等价：

```text
1000:0010 = 1001:0000
```

📌 这称为 **内存别名（Memory Alias）**。

---

## 九、学习与调试要点

- 牢记固定地址：

  - IVT：00000h
  - BDA：00400h
  - Boot：7C00h

- 调试时重点观察：

  - DS / SS 是否正确
  - 栈是否越界

---

> 本文适用于：8086 汇编、DOS 程序、Bootloader、实模式教学与调试。
